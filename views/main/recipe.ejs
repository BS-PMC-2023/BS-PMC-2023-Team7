<div onload="changeColor()" class="flex flex-1 justify-center">
  <div class="flex flex-1 lg:max-w-4xl xl:max-w-6xl py-4">
    <div class="flex flex-col flex-1 justify-center"> <!-- Vertical Slice -->
      <div class="flex-none w-full h-20 mb-4">
        <div class="bg-coffee flex flex-col flex-1 p-6 font-bold text-latte text-center text-xl w-full m-2 rounded-md">
          Thank you for reporting this recipe. We have received your report and will review it as soon as possible.
        </div>
      </div>
      <div class="flex flex-1 flex-col">
        <div id="background" class="bg-coffee flex flex-col p-6 font-normal text-lg w-full m-2 rounded-md">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="block w-16 mr-2 mb-2 aspect-square text-latte rounded-full border border-latte group-hover:border-espresso overflow-hidden transition-all">
                <img src="<%= recipe.user.avatar %>" class="rounded-xl w-full aspect-square object-cover pointer-events-none" />
              </div>
              <p class="pointer-events-none font-bold leading-tight sm:text-lg block truncate text-pistachio"><%= recipe.user.userName %></p>
              <%if (recipe.user.role > 1){%>
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 text-pistachio items-center pl-1"
                >
                  <path
                    d="M10.2426 16.3137L6 12.071L7.41421 10.6568L10.2426 13.4853L15.8995 7.8284L17.3137 9.24262L10.2426 16.3137Z"
                    fill="currentColor"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12ZM12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21Z"
                    fill="currentColor"
                  />
                </svg>
              <%}%>
            </div>
            <form action="/recipe" method="POST" class="flex items-center">
              <button id="report" type="submit" name="submit" value="report" class="group hover:scale-105 active:scale-90 transition-all border border-latte items-center relative p-2 m-1 text-latte hover:text-espresso bg-espresso hover:bg-pistachio hover:border-pistachio rounded-full hover:drop-shadow-xl">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12 6C12.5523 6 13 6.44772 13 7V13C13 13.5523 12.5523 14 12 14C11.4477 14 11 13.5523 11 13V7C11 6.44772 11.4477 6 12 6Z"
                    fill="currentColor"
                  />
                  <path
                    d="M12 16C11.4477 16 11 16.4477 11 17C11 17.5523 11.4477 18 12 18C12.5523 18 13 17.5523 13 17C13 16.4477 12.5523 16 12 16Z"
                    fill="currentColor"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12Z"
                    fill="currentColor"
                  />
                </svg>
              </button>
              <% if (locals.user && user.role > 1) { %>
                <%if (!isMarked) {%>
                  <button type="submit" name="submit" value="bookmark" id="bookmark" class="group hover:scale-105 active:scale-90 transition-all border border-latte items-center relative p-2 m-1 text-latte hover:text-espresso bg-espresso hover:bg-pistachio hover:border-pistachio rounded-full hover:drop-shadow-xl">
                    <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M12.0122 5.57169L10.9252 4.48469C8.77734 2.33681 5.29493 2.33681 3.14705 4.48469C0.999162 6.63258 0.999162 10.115 3.14705 12.2629L11.9859 21.1017L11.9877 21.0999L12.014 21.1262L20.8528 12.2874C23.0007 10.1395 23.0007 6.65711 20.8528 4.50923C18.705 2.36134 15.2226 2.36134 13.0747 4.50923L12.0122 5.57169ZM11.9877 18.2715L16.9239 13.3352L18.3747 11.9342L18.3762 11.9356L19.4386 10.8732C20.8055 9.50635 20.8055 7.29028 19.4386 5.92344C18.0718 4.55661 15.8557 4.55661 14.4889 5.92344L12.0133 8.39904L12.006 8.3918L12.005 8.39287L9.51101 5.89891C8.14417 4.53207 5.92809 4.53207 4.56126 5.89891C3.19442 7.26574 3.19442 9.48182 4.56126 10.8487L7.10068 13.3881L7.10248 13.3863L11.9877 18.2715Z"
                      fill="currentColor"
                    />
                  </svg>
                  </button>
                <%}%>
                <%if (isMarked) {%>
                  <button type="submit" name="submit" value="unbookmark" id="unbookmark" class="group hover:scale-105 active:scale-90 transition-all border border-latte items-center relative p-2 m-1 text-latte hover:text-espresso bg-espresso hover:bg-pistachio hover:border-pistachio rounded-full hover:drop-shadow-xl">
                    <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M 12.012 5.572 L 10.925 4.485 C 8.777 2.337 5.295 2.337 3.147 4.485 C 0.999 6.633 0.999 10.115 3.147 12.263 L 11.986 21.102 L 11.988 21.1 L 12.014 21.126 L 20.853 12.287 C 23.001 10.14 23.001 6.657 20.853 4.509 C 18.705 2.361 15.223 2.361 13.075 4.509 L 12.012 5.572 Z" fill="currentColor"></path>
                  </svg>
                  </button>
                <%}%>
              <%}%>
            </form>
          </div>
          <div class="flex">
            <p class="text-3xl font-bold text-latte"><%= recipe.recipeName %></p>
            <% if (recipe.aiMade) { %>
              <div class="relative">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-10 w-10 text-latte items-center pl-1 mt-0.5 top-1 right-1"
                >  
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M 4.836 16.011 L 12 20 L 19.2 16 L 19.2 8 L 12 4 L 4.8 8 L 4.836 16.011 Z M 12 2 L 3 7 L 3 17 L 12 22 L 21 17 L 21 7 L 12 2 Z" fill="currentColor"></path>
                </svg>
                <svg width="7.93" height="7.09" viewBox="-1 0 9 9" xmlns="http://www.w3.org/2000/svg" class="absolute h-5 w-5 text-latte items-center pl-1 mt-0.5 top-3 right-3"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt"><path d="M 1.4 7.09 L 0 7.09 L 2.95 0 L 3.05 0 L 6.01 7.09 L 4.65 7.09 L 4.26 6.08 L 1.77 6.08 L 1.4 7.09 Z M 7.93 7.09 L 6.65 7.09 L 6.65 0.12 L 7.93 0.12 L 7.93 7.09 Z M 2.99 2.65 L 2.83 3.21 L 2.13 5.11 L 3.89 5.11 L 3.16 3.21 L 2.99 2.65 Z" vector-effect="non-scaling-stroke" fill="currentColor"/></g></svg>
              </div>
            <% } %>
          </div>
          <div class="flex px-6 pt-4">
            <button class="group block mx-2 w-full aspect-square cursor-pointer text-latte rounded-xl border border-latte overflow-hidden drop-shadow-lg transition-all hover:drop-shadow-xl hover:scale-105 active:scale-90">
              <img src="<%= recipe.recipeImages[0] %>" class="rounded-xl w-full aspect-square object-cover pointer-events-none" />
              <span class="sr-only">View details</span>
            </button>
            <button class="group block mx-2 w-full aspect-square cursor-pointer text-latte rounded-xl border border-latte overflow-hidden drop-shadow-lg transition-all hover:drop-shadow-xl hover:scale-105 active:scale-90">
              <img src="<%= recipe.recipeImages[1] %>" class="rounded-xl w-full aspect-square object-cover pointer-events-none" />
              <span class="sr-only">View details</span>
            </button>
            <button class="group block mx-2 w-full aspect-square cursor-pointer text-latte rounded-xl border border-latte overflow-hidden drop-shadow-lg transition-all hover:drop-shadow-xl hover:scale-105 active:scale-90">
              <img src="<%= recipe.recipeImages[2] %>" class="rounded-xl w-full aspect-square object-cover pointer-events-none" />
              <span class="sr-only">View details</span>
            </button>
          </div>
          <p class="pt-8 text-2xl text-latte font-bold">
            Ingredients:
          </p>
          <div class="pt-2 flex">
            <textarea readonly class="block px-4 py-3 w-full h-60 font-bold transition-all rounded-md placeholder-latte text-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm"><%= recipe.ingredients %></textarea>
          </div>
          <p class="pt-8 text-2xl text-latte font-bold">
            Instructions:
          </p>
          <div class="pt-2 flex">
            <textarea readonly class="block px-4 py-3 w-full h-60 font-bold transition-all rounded-md placeholder-latte text-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm"><%= recipe.instructions %></textarea>
          </div>
          <p class="pt-8 text-2xl pb-2 text-latte font-bold">
            Allergies:
          </p>
          <input readonly value="<%= recipe.allergies %>" class="block px-4 py-3 w-full h-16 font-bold transition-all rounded-md placeholder-latte text-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
          </input>
          <p class="pt-8 text-2xl text-latte font-bold">
            Nutritions:
          </p>
          <div class="grid grid-cols-6 pt-4 gap-4 pb-4 items-center">
            <p class="text-latte font-bold">Energy (kcal):</p>
            <input readonly type="text" value="<%= recipe.nutritions.energy %>" class="px-4 py-3 font-bold transition-all rounded-md text-latte placeholder-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
            <p class="text-latte font-bold">Fatty acids (kg):</p>
            <input readonly type="text" value="<%= recipe.nutritions.fattyAcids %>" placeholder="0" class="px-4 py-3 font-bold transition-all rounded-md text-latte placeholder-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
            <p class="text-latte font-bold">Sodium (kg):</p>
            <input readonly type="text" value="<%= recipe.nutritions.sodium %>" class="px-4 py-3 font-bold transition-all rounded-md text-latte placeholder-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
            <p class="text-latte font-bold">Sugar (kg):</p>
            <input readonly type="text" value="<%= recipe.nutritions.sugar %>" class="px-4 py-3 font-bold transition-all rounded-md text-latte placeholder-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
            <p class="text-latte font-bold">Protein (kg):</p>
            <input readonly type="text" value="<%= recipe.nutritions.protein %>" class="px-4 py-3 font-bold transition-all rounded-md text-latte placeholder-latte bg-espresso border border-latte hover:border-pistachio hover:text-pistachio hover:placeholder-pistachio focus:border-pistachio focus:text-pistachio focus:placeholder-pistachio focus:ring-0 outline-none focus:outline-none text-sm">
          </div>
          <div class="flex justify-end items-center gap-2">
            <% if (recipe.badgesCount[0] > 0) { %>
              <div class="items-center flex flex-col">
                <img src="https://i.imgur.com/mexLqzQ.png" class="w-16 h-16 aspect-square object-cover hover:animate-wiggle"/>
                <p class="bg-espresso rounded-sm mt-2 px-2 text-latte"><%= recipe.badgesCount[0] %></p>
              </div>
            <% } if (recipe.badgesCount[1] > 0) { %>
              <div class="items-center flex flex-col">
                <img src="https://i.imgur.com/SrfSREa.png" class="w-16 h-16 aspect-square object-cover hover:animate-wiggle"/>
                <p class="bg-espresso rounded-sm mt-2 px-2 text-latte"><%= recipe.badgesCount[1] %></p>
              </div>
            <% } if (recipe.badgesCount[2] > 0) { %>
              <div class="items-center flex flex-col">
                <img src="https://i.imgur.com/nCm57df.png" class="w-16 h-16 aspect-square object-cover hover:animate-wiggle"/>
                <p class="bg-espresso rounded-sm mt-2 px-2 text-latte"><%= recipe.badgesCount[2] %></p>
              </div>
            <% } if (recipe.badgesCount[3] > 0) { %>
              <div class="items-center flex flex-col">
                <img src="https://i.imgur.com/GA9iqPB.png" class="w-16 h-16 aspect-square object-cover hover:animate-wiggle"/>
                <p class="bg-espresso rounded-sm mt-2 px-2 text-latte"><%= recipe.badgesCount[3] %></p>
              </div>
            <% } %>
          </div>
          <div class="pt-4 flex justify-between items-center">
              <p class="text-2xl text-latte font-bold">
                <% if (!recipe.hideRating) { %> Rating: <% } %>
              </p>
            <% if (locals.user && user.role > 1) { %>
              <form class="relative" action="/recipe" method="POST">
                <% if (isBadgeButton) { %>
                  <button id="badges-button" type="button" class="group hover:scale-105 active:scale-90 transition-all border border-latte items-center relative p-2 m-1 text-latte hover:text-espresso bg-espresso hover:bg-pistachio hover:border-pistachio rounded-full hover:drop-shadow-xl">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M19 9C19 11.3787 17.8135 13.4804 16 14.7453V22H13.4142L12 20.5858L10.5858 22H8V14.7453C6.18652 13.4804 5 11.3787 5 9C5 5.13401 8.13401 2 12 2C15.866 2 19 5.13401 19 9ZM17 9C17 11.7614 14.7614 14 12 14C9.23858 14 7 11.7614 7 9C7 6.23858 9.23858 4 12 4C14.7614 4 17 6.23858 17 9ZM10 19.7573L12 17.7573L14 19.7574V15.7101C13.3663 15.8987 12.695 16 12 16C11.305 16 10.6337 15.8987 10 15.7101V19.7573Z"
                      fill="currentColor"
                      />
                    </svg>
                  </button>
                <% } %>
                <div id="badges-menu" class="hidden absolute gap-2 bg-espresso rounded-md border border-latte right-0 p-4 transition-all group hover:scale-105">
                  <button onclick="rememberScroll();" id="badge1Button" type="submit" value="1" name="badges" class="w-16 h-16 block transition-all hover:scale-110 active:scale-90">
                    <img src="https://i.imgur.com/mexLqzQ.png" class="w-16 h-16 aspect-square object-cover"/>
                  </button>
                  <button onclick="rememberScroll();" id="badge2Button" type="submit" value="2" name="badges" class="w-16 h-16 block transition-all hover:scale-110 active:scale-90">
                    <img src="https://i.imgur.com/SrfSREa.png" class="w-16 h-16 aspect-square object-cover"/>
                  </button>
                  <button onclick="rememberScroll();" id="badge3Button" type="submit" value="3" name="badges" class="w-16 h-16 block transition-all hover:scale-110 active:scale-90">
                    <img src="https://i.imgur.com/nCm57df.png" class="w-16 h-16 aspect-square object-cover"/>
                  </button>
                  <button onclick="rememberScroll();" id="badge4Button" type="submit" value="4" name="badges" class="w-16 h-16 block transition-all hover:scale-110 active:scale-90">
                    <img src="https://i.imgur.com/GA9iqPB.png" class="w-16 h-16 aspect-square object-cover"/>
                  </button>
                </div>
              </form>
            <% } %>
          </div>
          <% if (!recipe.hideRating) { %>
            <div class="flex items-center mt-3 mb-3">
              <svg aria-hidden="true" id="star1" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>First star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              <svg aria-hidden="true" id="star2" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Second star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              <svg aria-hidden="true" id="star3" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Third star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              <svg aria-hidden="true" id="star4" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Fourth star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              <svg aria-hidden="true" id="star5" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Fifth star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              <p class="ml-2 text-sm font-bold text-espresso"><%= recipe.rating.avg %> out of 5</p>
            </div>
            <p class="text-sm font-bold text-espresso"><%= recipe.rating.total %> global ratings</p>
            <div class="flex items-center mt-4 group">
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte">5 star</span>
                <div class="w-2/4 h-5 mx-4 bg-espresso rounded">
                    <div id="line5" class="h-5 bg-pistachio transition-all group-hover:bg-latte rounded"></div>
                </div>
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte"><%= recipe.ratingFancy[4] %>%</span>
            </div>
            <div class="flex items-center mt-4 group">
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte">4 star</span>
                <div class="w-2/4 h-5 mx-4 bg-espresso rounded">
                  <div id="line4" class="h-5 bg-pistachio transition-all group-hover:bg-latte rounded"></div>
                </div>
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte"><%= recipe.ratingFancy[3] %>%</span>
            </div>
            <div class="flex items-center mt-4 group">
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte">3 star</span>
                <div class="w-2/4 h-5 mx-4 bg-espresso rounded">
                  <div id="line3" class="h-5 bg-pistachio transition-all group-hover:bg-latte rounded"></div>
                </div>
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte"><%= recipe.ratingFancy[2] %>%</span>
            </div>
            <div class="flex items-center mt-4 group">
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte">2 star</span>
                <div class="w-2/4 h-5 mx-4 bg-espresso rounded">
                  <div id="line2" class="h-5 bg-pistachio transition-all group-hover:bg-latte rounded"></div>
                </div>
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte"><%= recipe.ratingFancy[1] %>%</span>
            </div>
            <div class="flex items-center mt-4 group">
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte">1 star</span>
                <div class="w-2/4 h-5 mx-4 bg-espresso rounded">
                  <div id="line1" class="h-5 bg-pistachio transition-all group-hover:bg-latte rounded"></div>
                </div>
                <span class="text-sm font-bold text-espresso transition-all group-hover:text-latte"><%= recipe.ratingFancy[0] %>%</span>
            </div> 
          <% } %>
        </div>
        
        <form class="flex justify-between px-2 pt-2 pb-12" action="/recipe" method="POST">
          <div class="flex items-center flex-row-reverse">
            <% if (!recipe.hideRating) { %>
              <button onclick="rememberScroll();" value="5" name="rating" id="rating-5" type="submit" class="peer cursor-pointer peer-hover:text-latte hover:text-latte hover:scale-110 active:scale-95 transition-all">
                <svg for="rating-5" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              </button>
              <button onclick="rememberScroll();" value="4" name="rating" id="rating-4" type="submit" class="peer cursor-pointer peer-hover:text-latte hover:text-latte hover:scale-110 active:scale-95 transition-all">
                <svg for="rating-4" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              </button>
              <button onclick="rememberScroll();" value="3" name="rating" id="rating-3" type="submit" class="peer cursor-pointer peer-hover:text-latte hover:text-latte hover:scale-110 active:scale-95 transition-all">
                <svg for="rating-3" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              </button>
              <button onclick="rememberScroll();" value="2" name="rating" id="rating-2" type="submit" class="peer cursor-pointer peer-hover:text-latte hover:text-latte hover:scale-110 active:scale-95 transition-all">
                <svg for="rating-2" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              </button>
              <button onclick="rememberScroll();" value="1" name="rating" id="rating-1" type="submit" class="peer cursor-pointer peer-hover:text-latte hover:text-latte hover:scale-110 active:scale-95 transition-all">
                <svg for="rating-1" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
              </button>
              <p class="text-latte text-xl pb-1.5 pr-2">Your Rating:
              </p>
            <% } %>
          </div>
          <a href="<%= returnPage %>" <button class="bg-espresso mx-2 px-4 rounded-full font-bold text-latte uppercase py-2 transition-all hover:drop-shadow-xl hover:bg-pistachio hover:text-espresso hover:scale-105 active:scale-90">Close Recipe
          </button></a>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", refresh);
  const bg = document.querySelector('#background');
  const color = "<%= recipe.color %>";
  if (color === 'original') {
    bg.classList.remove(`bg-tasty`, 'bg-cold', 'bg-sweet');
    bg.classList.add('bg-coffee');
  } else if (color === 'tasty') 
  {
    bg.classList.remove('bg-coffee', 'bg-cold', 'bg-sweet');
    bg.classList.add('bg-tasty');
  } else if (color === 'cold') 
  {
    bg.classList.remove('bg-coffee', `bg-tasty`, 'bg-sweet');
    bg.classList.add(`bg-cold`);
  } else if (color === 'sweet') 
  {
    bg.classList.remove('bg-coffee', `bg-tasty`, 'bg-cold');
    bg.classList.add(`bg-sweet`);
  }
  const bookmark = document.querySelector('#bookmark');
  const unbookmark = document.querySelector('#unbookmark');

  function refresh(){
    ratings();
    rate();
    loadScroll();
  }
  //Handle rating
  function rate(){ 
    var rating5 = document.querySelector('#rating-5');
    var rating4 = document.querySelector('#rating-4');
    var rating3 = document.querySelector('#rating-3');
    var rating2 = document.querySelector('#rating-2');
    var rating1 = document.querySelector('#rating-1');
    const color = 'text-pistachio';
    const nocolor = 'text-coffee';
    var rating = "<%= recipe.userRating %>"; 
    switch(rating){
      case "1": rate1(); break;
      case "2": rate2(); break;
      case "3": rate3(); break;
      case "4": rate4(); break;
      case "5": rate5(); break;
      default: unrate(); break;
    }
    function rate5(){
      rating5.classList.add(color);
      rating4.classList.add(color);
      rating3.classList.add(color);
      rating2.classList.add(color);
      rating1.classList.add(color);
    }
    function rate4() {
      rating5.classList.add(nocolor);
      rating4.classList.add(color);
      rating3.classList.add(color);
      rating2.classList.add(color);
      rating1.classList.add(color);
    }
    function rate3(){
      rating5.classList.add(nocolor);
      rating4.classList.add(nocolor);
      rating3.classList.add(color);
      rating2.classList.add(color);
      rating1.classList.add(color);
    }
    function rate2(){
      rating5.classList.add(nocolor);
      rating4.classList.add(nocolor);
      rating3.classList.add(nocolor);
      rating2.classList.add(color);
      rating1.classList.add(color);
    }
    function rate1(){
      rating5.classList.add(nocolor);
      rating4.classList.add(nocolor);
      rating3.classList.add(nocolor);
      rating2.classList.add(nocolor);
      rating1.classList.add(color);
    }
    function unrate(){
      rating5.classList.add(nocolor);
      rating4.classList.add(nocolor);
      rating3.classList.add(nocolor);
      rating2.classList.add(nocolor);
      rating1.classList.add(nocolor);
    }
  }

  //Handle recipe scores
  function ratings(){
    document.getElementById("line1").style.width = "<%= recipe.ratingFancy[0] %>%"
    document.getElementById("line2").style.width = "<%= recipe.ratingFancy[1] %>%"
    document.getElementById("line3").style.width = "<%= recipe.ratingFancy[2] %>%"
    document.getElementById("line4").style.width = "<%= recipe.ratingFancy[3] %>%"
    document.getElementById("line5").style.width = "<%= recipe.ratingFancy[4] %>%"
    var star5 = document.querySelector('#star5');
    var star4 = document.querySelector('#star4');
    var star3 = document.querySelector('#star3');
    var star2 = document.querySelector('#star2');
    var star1 = document.querySelector('#star1');
    const color = 'text-pistachio'
    const nocolor = 'text-espresso'
    var star = "<%= recipe.rating.star %>" 
    switch(star){
      case "1": rate1(); break;
      case "2": rate2(); break;
      case "3": rate3(); break;
      case "4": rate4(); break;
      case "5": rate5(); break;
      default: unrate(); break;
    }
    function rate5(){
      star5.classList.add(color);
      star4.classList.add(color);
      star3.classList.add(color);
      star2.classList.add(color);
      star1.classList.add(color);
    }
    function rate4(){
      star5.classList.add(nocolor);
      star4.classList.add(color);
      star3.classList.add(color);
      star2.classList.add(color);
      star1.classList.add(color);
    }
    function rate3(){
      star5.classList.add(nocolor);
      star4.classList.add(nocolor);
      star3.classList.add(color);
      star2.classList.add(color);
      star1.classList.add(color);
    }
    function rate2(){
      star5.classList.add(nocolor);
      star4.classList.add(nocolor);
      star3.classList.add(nocolor);
      star2.classList.add(color);
      star1.classList.add(color);
    }
    function rate1(){
      star5.classList.add(nocolor);
      star4.classList.add(nocolor);
      star3.classList.add(nocolor);
      star2.classList.add(nocolor);
      star1.classList.add(color);
    }
    function unrate(){
      star5.classList.add(nocolor);
      star4.classList.add(nocolor);
      star3.classList.add(nocolor);
      star2.classList.add(nocolor);
      star1.classList.add(nocolor);
    }
  }

  //Handle scroll
  function loadScroll(event) {
    var scrollpos = localStorage.getItem("scrollpos");
    if (scrollpos) window.scrollTo(0, scrollpos);
  }
  //save scroll position on click
  function rememberScroll(){ 
    window.onbeforeunload = (e) => 
      localStorage.setItem("scrollpos", window.scrollY);
  }
  //default - no scroll memory
  window.onbeforeunload = (e) => 
    localStorage.removeItem("scrollpos");
  
  const badgeButton = document.querySelector('#badges-button');
  const badgeMenu = document.querySelector('#badges-menu');
  badgeButton.addEventListener('click', () => 
  {
    if (badgeMenu.classList.contains('hidden')) 
    {
      badgeMenu.classList.remove('hidden');
      badgeMenu.classList.add('flex');
    } 
    else 
    {
      badgeMenu.classList.add('hidden');
      badgeMenu.classList.remove('flex');
    }
  });
  document.addEventListener('click', (event) => {
    if (!badgeMenu.contains(event.target) && !badgeButton.contains(event.target)) 
    {
      badgeMenu.classList.add('hidden');
      badgeMenu.classList.remove('flex');
    }
  });
</script>